<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SchulensteinChat</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0d1b2a">
<style>
body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:#0d1b2a;color:#fff}
#login{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#0008}
.box{background:#14213d;padding:24px;border-radius:14px;width:340px}
input,button{width:100%;padding:12px;border-radius:10px;border:0;margin-top:10px}
button{background:#00d1ff;font-weight:700}
#app{display:none;padding:16px;max-width:900px;margin:auto}
.msg{background:#1b263b;padding:10px;border-radius:8px;margin-bottom:8px}
</style>
</head>
<body>

<div id="login">
  <div class="box">
    <h2>SchulensteinChat</h2>
    <input id="name" placeholder="Name" />
    <input id="pass" type="password" placeholder="Passwort" />
    <button onclick="login()">Einloggen</button>
  </div>
</div>

<div id="app">
  <h1>SchulensteinChat</h1>
  <div id="msgs"></div>
  <input id="text" placeholder="Nachricht..." />
  <button onclick="send()">Senden</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-messaging-compat.js"></script>

<script>
// FIREBASE
const firebaseConfig={apiKey:"AIzaSyDxr-d1ZKp3wt3i289o6FKmevr3s8Uw3WA",authDomain:"okuler.firebaseapp.com",databaseURL:"https://okuler-default-rtdb.firebaseio.com",projectId:"okuler",messagingSenderId:"853942864718",appId:"1:853942864718:web:337671e3596467ae7e6c1f"};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const messaging=firebase.messaging();

const PASS="Hogachat";
let USER="";

function login(){
  if(pass.value!==PASS) return alert("Falsches Passwort");
  USER=name.value.trim();
  if(!USER) return alert("Name fehlt");
  login.style.display="none";
  app.style.display="block";
  start();
  requestPush();
}

function start(){
  db.ref("messages").limitToLast(100).on("child_added",s=>{
    const m=s.val();
    const d=document.createElement("div");
    d.className="msg";
    d.textContent=m.text;
    msgs.appendChild(d);
  });
}

function send(){
  if(!text.value) return;
  db.ref("messages").push({text:text.value,time:Date.now()});
  text.value="";
}

// PUSH (ECHT)
async function requestPush(){
  const reg=await navigator.serviceWorker.register("sw.js");
  messaging.useServiceWorker(reg);
  const token=await messaging.getToken({vapidKey:"BURAYA_VAPID_KEY"});
  console.log("Push Token:",token);
}
</script>
</body>
</html>
