<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Hogachat</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ================= LOADER CSS ================= -->
<style>
/* From Uiverse.io by anand_4957 */
#loaderScreen{
  position:fixed;
  inset:0;
  background:#0b1d2a;
  z-index:9999;
}

.loader{
  position:absolute;
  top:50%;left:50%;
  margin-left:-50px;
  animation:speeder .4s linear infinite;
}
.loader > span{
  height:5px;width:35px;background:#fff;
  position:absolute;top:-19px;left:60px;
  border-radius:2px 10px 1px 0;
}
.base span{
  position:absolute;width:0;height:0;
  border-top:6px solid transparent;
  border-right:100px solid #fff;
  border-bottom:6px solid transparent;
}
.base span:before{
  content:"";height:22px;width:22px;border-radius:50%;
  background:#fff;position:absolute;right:-110px;top:-16px;
}
.base span:after{
  content:"";position:absolute;width:0;height:0;
  border-right:55px solid #fff;border-bottom:16px solid transparent;
  top:-16px;right:-98px;
}
.face{
  position:absolute;height:12px;width:20px;
  background:#fff;border-radius:20px 20px 0 0;
  transform:rotate(-40deg);right:-125px;top:-15px;
}
.face:after{
  content:"";height:12px;width:12px;background:#fff;
  right:4px;top:7px;position:absolute;
  transform:rotate(40deg);border-radius:0 0 0 2px;
}
@keyframes speeder{
  0%{transform:translate(2px,1px)}
  50%{transform:translate(-1px,3px)}
  100%{transform:translate(1px,-2px)}
}
</style>

<!-- ================= APP CSS ================= -->
<style>
*{box-sizing:border-box}
body{
  margin:0;height:100vh;
  background:linear-gradient(#0b1d2a,#123);
  font-family:Segoe UI,sans-serif;
  color:#fff;overflow:hidden;
}

/* BOX */
.box,.adminBox{
  background:rgba(0,0,0,.6);
  padding:25px;border-radius:20px;
  box-shadow:0 0 25px rgba(255,255,255,.2);
}

#login,#chat,#adminPanel{
  position:absolute;inset:0;
  display:flex;align-items:center;justify-content:center;
}
#chat,#adminPanel{display:none}

/* INPUT */
input,button{
  width:100%;padding:12px;margin:6px 0;
  border-radius:10px;border:none;font-size:16px;
}
button{background:#1e90ff;color:#fff;cursor:pointer}

/* CHAT */
#messages{
  height:45vh;overflow:auto;
  background:rgba(0,0,0,.4);
  padding:10px;border-radius:10px;
}
.msg{margin-bottom:8px}
.adminMsg{
  background:rgba(255,215,0,.25);
  padding:6px;border-radius:8px
}

/* ADMIN BTN */
#adminBtn{
  position:fixed;
  top:10px;right:10px;
  z-index:9000;
  display:none;
}

/* ‚ùÑÔ∏è SNOW */
.snow{
  position:fixed;
  top:-10px;
  width:8px;height:8px;
  background:white;
  border-radius:50%;
  opacity:.8;
  animation:fall linear forwards;
}
@keyframes fall{
  to{transform:translateY(110vh)}
}
</style>
</head>

<body>

<!-- ================= LOADER ================= -->
<div id="loaderScreen">
  <div class="loader">
    <span></span>
    <div class="base"><span></span><div class="face"></div></div>
  </div>
</div>

<button id="adminBtn" onclick="openAdmin()">‚öôÔ∏è</button>

<!-- LOGIN -->
<div id="login">
  <div class="box">
    <h2>‚ùÑÔ∏è Hogachat</h2>
    <input id="name" placeholder="Name">
    <input id="password" type="password" placeholder="Passwort">
    <button onclick="login()">Einloggen</button>
  </div>
</div>

<!-- CHAT -->
<div id="chat">
  <div class="box">
    <div id="onlineCount">Online: 0</div>
    <div id="messages"></div>
    <input id="message" placeholder="Nachricht">
    <button onclick="sendMessage()">Senden</button>
  </div>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel">
  <div class="adminBox">
    <h3>üëë Admin Panel</h3>
    <ul id="userList"></ul>
    <button onclick="closeAdmin()">Schlie√üen</button>
  </div>
</div>

<!-- ================= FIREBASE + JS ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getDatabase, ref, push, onChildAdded,
  onValue, set, remove, onDisconnect
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const app = initializeApp({
  apiKey:"AIzaSyDxr-d1ZKp3wt3i289o6FKmevr3s8Uw3WA",
  databaseURL:"https://okuler-default-rtdb.firebaseio.com"
});
const db=getDatabase(app);

/* ===== LOADER FIX ===== */
window.addEventListener("load",()=>{
  const loader=document.getElementById("loaderScreen");
  setTimeout(()=>{
    loader.remove();   // üëà tamamen kaldƒ±r
  },1200);
});

/* ‚ùÑÔ∏è SNOW EFFECT */
setInterval(()=>{
  const s=document.createElement("div");
  s.className="snow";
  s.style.left=Math.random()*window.innerWidth+"px";
  s.style.animationDuration=3+Math.random()*5+"s";
  document.body.appendChild(s);
  setTimeout(()=>s.remove(),8000);
},200);

/* ===== STATE ===== */
let isAdmin=false;
let currentUser="";
let userKey="";

/* ===== LOGIN ===== */
window.login=()=>{
  const name=document.getElementById("name").value.trim();
  const pass=document.getElementById("password").value.trim();
  if(!name||!pass)return alert("Bo≈ü bƒ±rakma");

  if(pass==="mirhan5685") isAdmin=true;
  else if(pass==="Hogachat") isAdmin=false;
  else return alert("Falsches Passwort");

  currentUser=name;
  login.style.display="none";
  chat.style.display="flex";
  if(isAdmin) adminBtn.style.display="block";

  userKey=Date.now();
  const uRef=ref(db,"online/"+userKey);
  set(uRef,name);
  onDisconnect(uRef).remove();

  onValue(ref(db,"online"),s=>{
    onlineCount.textContent=
      "Online: "+(s.exists()?Object.keys(s.val()).length:0);

    if(isAdmin){
      userList.innerHTML="";
      Object.entries(s.val()||{}).forEach(([k,v])=>{
        userList.innerHTML+=`
        <li>${v}
          <button onclick="banUser('${v}')">BAN</button>
        </li>`;
      });
    }
  });

  onChildAdded(ref(db,"messages"),snap=>{
    const m=snap.val();
    const d=document.createElement("div");
    d.className=m.admin?"msg adminMsg":"msg";
    d.textContent=(m.admin?"üëë Mirhan":"Anonym")+": "+m.text;
    if(isAdmin){
      d.onclick=()=>remove(ref(db,"messages/"+snap.key));
    }
    messages.appendChild(d);
  });
};

/* ===== SEND ===== */
window.sendMessage=()=>{
  const msg=message.value.trim();
  if(!msg)return;

  onValue(ref(db,"bans/"+currentUser),s=>{
    if(s.exists()) return alert("Banlandƒ±n");
    push(ref(db,"messages"),{text:msg,admin:isAdmin});
    message.value="";
  },{onlyOnce:true});
};

/* ===== BAN ===== */
window.banUser=(name)=>{
  set(ref(db,"bans/"+name),true);
};

/* ===== ADMIN PANEL ===== */
window.openAdmin=()=>{
  adminPanel.style.display="flex";
};
window.closeAdmin=()=>{
  adminPanel.style.display="none";
};
</script>

</body>
</html>
